'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.tokens = tokens;

var _Position = require('./Position');

const FIRST_LINE = 1;
const FIRST_POSITION = 1;

function* _tokens(string) {

  let line = FIRST_LINE;
  let position = FIRST_POSITION;
  let i = 0;
  let n = string.length;

  let buffer = '';

  const flush = function* () {
    if (buffer !== '') {
      yield ['text', buffer, new _Position.Position(line, position)];
      position += buffer.length;
      buffer = '';
    }
  };

  while (i < n) {
    const c = string[i];
    if (c === '\\') {
      let cmd = '\\';
      while (++i < n) {
        // read command
        const d = string[i];
        // http://www.tex.ac.uk/FAQ-whatmacros.html
        if (d >= 'a' && d <= 'z' || d >= 'A' && d <= 'Z') cmd += d;else {
          if (cmd === '\\') {
            cmd += d;
            ++i;
          }
          break;
        }
      }

      yield* flush();

      let cmdtype = 'othercmd';

      if (cmd.substr(0, 3) === '\\if') cmdtype = 'ifcmd';else if (cmd.substr(cmd.length - 5, 5) === 'false') cmdtype = 'falsecmd';else if (cmd.substr(cmd.length - 4, 4) === 'true') cmdtype = 'truecmd';else if (cmd === '\\newif') cmdtype = 'newif';else if (cmd === '\\else') cmdtype = 'else';else if (cmd === '\\def') cmdtype = 'def';else if (cmd === '\\newcommand') cmdtype = 'newcommand';else if (cmd === '\\fi') cmdtype = 'fi';else if (cmd === '\\(') cmdtype = '\\(';else if (cmd === '\\)') cmdtype = '\\)';else if (cmd === '\\[') cmdtype = '\\[';else if (cmd === '\\]') cmdtype = '\\]';

      yield [cmdtype, cmd, new _Position.Position(line, position)];
      if (cmd === '\\\n') {
        ++line;
        position = FIRST_POSITION;
      } else {
        position += cmd.length;
      }
    } else if (c === '#') {

      // read arg number
      let arg = '#';
      while (++i < n) {
        const d = string[i];
        if (d >= '0' && d <= '9') arg += d;else {
          if (arg === '#') throw new Error('Incomplete #');
          break;
        }
      }
      yield* flush();
      yield ['arg', arg, new _Position.Position(line, position)];
      position += arg.length;
    } else if (c === '{') {
      yield* flush();
      yield ['{', '{', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '}') {
      yield* flush();
      yield ['}', '}', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '[') {
      yield* flush();
      yield ['[', '[', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === ']') {
      yield* flush();
      yield [']', ']', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '*') {
      yield* flush();
      yield ['*', '*', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '$') {
      yield* flush();
      yield ['$', '$', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === ' ') {
      yield* flush();
      yield [' ', ' ', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '\t') {
      yield* flush();
      yield ['\t', '\t', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '\n') {
      yield* flush();
      yield ['\n', '\n', new _Position.Position(line, position)];
      ++line;
      position = FIRST_POSITION;
      ++i;
    } else if (c === '%') {
      yield* flush();
      buffer = '%';
      let d = '';
      while (++i < n) {
        d = string[i];
        if (d === '\n') break;
        buffer += d;
      }
      yield ['comment', buffer, new _Position.Position(line, position)];
      position += buffer.length;
      buffer = '';
      if (i < n) {
        yield ['\n', '\n', new _Position.Position(line, position)];
        ++line;
        position = FIRST_POSITION;
      }
      ++i;
    } else {
      buffer += c;
      ++i;
    }
  }

  yield* flush();
}

function* tokens(string) {

  for (const [terminal, buffer, position] of _tokens(string)) {
    yield {
      'type': 'leaf',
      terminal,
      buffer,
      position
    };
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90b2tlbnMuanMiXSwibmFtZXMiOlsidG9rZW5zIiwiRklSU1RfTElORSIsIkZJUlNUX1BPU0lUSU9OIiwiX3Rva2VucyIsInN0cmluZyIsImxpbmUiLCJwb3NpdGlvbiIsImkiLCJuIiwibGVuZ3RoIiwiYnVmZmVyIiwiZmx1c2giLCJQb3NpdGlvbiIsImMiLCJjbWQiLCJkIiwiY21kdHlwZSIsInN1YnN0ciIsImFyZyIsIkVycm9yIiwidGVybWluYWwiXSwibWFwcGluZ3MiOiI7Ozs7O1FBaUxpQkEsTSxHQUFBQSxNOztBQWpMakI7O0FBRUEsTUFBTUMsYUFBYSxDQUFuQjtBQUNBLE1BQU1DLGlCQUFpQixDQUF2Qjs7QUFFQSxVQUFVQyxPQUFWLENBQW9CQyxNQUFwQixFQUE2Qjs7QUFFM0IsTUFBSUMsT0FBT0osVUFBWDtBQUNBLE1BQUlLLFdBQVdKLGNBQWY7QUFDQSxNQUFJSyxJQUFJLENBQVI7QUFDQSxNQUFJQyxJQUFJSixPQUFPSyxNQUFmOztBQUVBLE1BQUlDLFNBQVMsRUFBYjs7QUFFQSxRQUFNQyxRQUFRLGFBQWE7QUFDekIsUUFBS0QsV0FBVyxFQUFoQixFQUFxQjtBQUNuQixZQUFNLENBQUUsTUFBRixFQUFXQSxNQUFYLEVBQW9CLElBQUlFLGtCQUFKLENBQWFQLElBQWIsRUFBbUJDLFFBQW5CLENBQXBCLENBQU47QUFDQUEsa0JBQVlJLE9BQU9ELE1BQW5CO0FBQ0FDLGVBQVMsRUFBVDtBQUNEO0FBQ0YsR0FORDs7QUFRQSxTQUFRSCxJQUFJQyxDQUFaLEVBQWdCO0FBQ2QsVUFBTUssSUFBSVQsT0FBT0csQ0FBUCxDQUFWO0FBQ0EsUUFBS00sTUFBTSxJQUFYLEVBQWtCO0FBQ2hCLFVBQUlDLE1BQU0sSUFBVjtBQUNBLGFBQVEsRUFBRVAsQ0FBRixHQUFNQyxDQUFkLEVBQWtCO0FBQUU7QUFDekIsY0FBTU8sSUFBSVgsT0FBT0csQ0FBUCxDQUFWO0FBQ0E7QUFDQSxZQUFPUSxLQUFLLEdBQUwsSUFBWUEsS0FBSyxHQUFuQixJ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LE1BQU0sQ0FBRWdCLFFBQUYsRUFBYVYsTUFBYixFQUFzQkosUUFBdEIsQ0FBWixJQUFnREgsUUFBUUMsTUFBUixDQUFoRCxFQUFrRTtBQUNoRSxVQUFNO0FBQ0osY0FBUyxNQURMO0FBRUpnQixjQUZJO0FBR0pWLFlBSEk7QUFJSko7QUFKSSxLQUFOO0FBTUQ7QUFDRiIsImZpbGUiOiJ0b2tlbnMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb3NpdGlvbiB9IGZyb20gJy4vUG9zaXRpb24nIDtcblxuY29uc3QgRklSU1RfTElORSA9IDE7XG5jb25zdCBGSVJTVF9QT1NJVElPTiA9IDE7XG5cbmZ1bmN0aW9uKiBfdG9rZW5zICggc3RyaW5nICkge1xuXG4gIGxldCBsaW5lID0gRklSU1RfTElORSA7XG4gIGxldCBwb3NpdGlvbiA9IEZJUlNUX1BPU0lUSU9OO1xuICBsZXQgaSA9IDAgO1xuICBsZXQgbiA9IHN0cmluZy5sZW5ndGggO1xuXG4gIGxldCBidWZmZXIgPSAnJztcblxuICBjb25zdCBmbHVzaCA9IGZ1bmN0aW9uKiAoKSB7XG4gICAgaWYgKCBidWZmZXIgIT09ICcnICkge1xuICAgICAgeWllbGQgWyAndGV4dCcgLCBidWZmZXIgLCBuZXcgUG9zaXRpb24obGluZSwgcG9zaXRpb24pIF0gO1xuICAgICAgcG9zaXRpb24gKz0gYnVmZmVyLmxlbmd0aDtcbiAgICAgIGJ1ZmZlciA9ICcnO1xuICAgIH1cbiAgfVxuXG4gIHdoaWxlICggaSA8IG4gKSB7XG4gICAgY29uc3QgYyA9IHN0cmluZ1tpXSA7XG4gICAgaWYgKCBjID09PSAnXFxcXCcgKSB7XG4gICAgICBsZXQgY21kID0gJ1xcXFwnIDtcbiAgICAgIHdoaWxlICggKytpIDwgbiApIHsgLy8gcmVhZCBjb21tYW5kXG5cdGNvbnN0IGQgPSBzdHJpbmdbaV07XG5cdC8vIGh0dHA6Ly93d3cudGV4LmFjLnVrL0ZBUS13aGF0bWFjcm9zLmh0bWxcblx0aWYgKCAoIGQgPj0gJ2EnICYmIGQgPD0gJ3onICkgfHwgKCBkID49ICdBJyAmJiBkIDw9ICdaJyApICkgY21kICs9IGQ7XG5cdGVsc2Uge1xuXHQgIGlmICggY21kID09PSAnXFxcXCcgKSB7XG5cdCAgICBjbWQgKz0gZDtcblx0ICAgICsraTtcblx0ICB9XG5cdCAgYnJlYWs7XG5cdH1cbiAgICAgIH1cblxuICAgICAgeWllbGQqIGZsdXNoKCk7XG5cbiAgICAgIGxldCBjbWR0eXBlID0gJ290aGVyY21kJyA7XG5cbiAgICAgIGlmICggY21kLnN1YnN0cigwLDMpID09PSAnXFxcXGlmJyApIGNtZHR5cGUgPSAnaWZjbWQnIDtcblxuICAgICAgZWxzZSBpZiAoY21kLnN1YnN0cihjbWQubGVuZ3RoLTUsIDUpID09PSAnZmFsc2UnICkgY21kdHlwZSA9ICdmYWxzZWNtZCcgO1xuXG4gICAgICBlbHNlIGlmIChjbWQuc3Vic3RyKGNtZC5sZW5ndGgtNCwgNCkgPT09ICd0cnVlJyApIGNtZHR5cGUgPSAndHJ1ZWNtZCcgO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXG5ld2lmJyApIGNtZHR5cGUgPSAnbmV3aWYnIDtcblxuICAgICAgZWxzZSBpZiAoIGNtZCA9PT0gJ1xcXFxlbHNlJyApIGNtZHR5cGUgPSAnZWxzZScgO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXGRlZicgKSBjbWR0eXBlID0gJ2RlZicgO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXG5ld2NvbW1hbmQnICkgY21kdHlwZSA9ICduZXdjb21tYW5kJyA7XG5cbiAgICAgIGVsc2UgaWYgKCBjbWQgPT09ICdcXFxcZmknICkgY21kdHlwZSA9ICdmaScgO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXCgnICkgY21kdHlwZSA9ICdcXFxcKCcgO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXCknICkgY21kdHlwZSA9ICdcXFxcKScgO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXFsnICkgY21kdHlwZSA9ICdcXFxcWycgO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXF0nICkgY21kdHlwZSA9ICdcXFxcXScgO1xuXG4gICAgICB5aWVsZCBbIGNtZHR5cGUgLCBjbWQgLCBuZXcgUG9zaXRpb24obGluZSwgcG9zaXRpb24pIF0gO1xuICAgICAgaWYgKCBjbWQgPT09ICdcXFxcXFxuJyApIHtcblx0KytsaW5lO1xuXHRwb3NpdGlvbiA9IEZJUlNUX1BPU0lUSU9OO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG5cdHBvc2l0aW9uICs9IGNtZC5sZW5ndGg7XG4gICAgICB9XG5cbiAgICB9XG4gICAgZWxzZSBpZiAoIGMgPT09ICcjJyApIHtcblxuICAgICAgLy8gcmVhZCBhcmcgbnVtYmVyXG4gICAgICBsZXQgYXJnID0gJyMnIDtcbiAgICAgIHdoaWxlICggKytpIDwgbiApIHtcblx0Y29uc3QgZCA9IHN0cmluZ1tpXTtcblx0aWYgKCBkID49ICcwJyAmJiBkIDw9ICc5JyApIGFyZyArPSBkO1xuXHRlbHNlIHtcblx0ICBpZiAoIGFyZyA9PT0gJyMnICkgdGhyb3cgbmV3IEVycm9yKCdJbmNvbXBsZXRlICMnKSA7XG5cdCAgYnJlYWs7XG5cdH1cbiAgICAgIH1cbiAgICAgIHlpZWxkKiBmbHVzaCgpO1xuICAgICAgeWllbGQgWyAnYXJnJyAsIGFyZyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICBwb3NpdGlvbiArPSBhcmcubGVuZ3RoO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ3snICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICd7JyAsICd7JyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ30nICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICd9JyAsICd9JyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ1snICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICdbJyAsICdbJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ10nICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICddJyAsICddJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJyonICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICcqJyAsICcqJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJyQnICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICckJyAsICckJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJyAnICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICcgJyAsICcgJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ1xcdCcgKSB7XG4gICAgICB5aWVsZCogZmx1c2goKTtcbiAgICAgIHlpZWxkIFsgJ1xcdCcgLCAnXFx0JyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ1xcbicgKSB7XG4gICAgICB5aWVsZCogZmx1c2goKTtcbiAgICAgIHlpZWxkIFsgJ1xcbicgLCAnXFxuJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK2xpbmU7XG4gICAgICBwb3NpdGlvbiA9IEZJUlNUX1BPU0lUSU9OO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJyUnKSB7XG4gICAgICB5aWVsZCogZmx1c2goKTtcbiAgICAgIGJ1ZmZlciA9ICclJztcbiAgICAgIGxldCBkID0gJyc7XG4gICAgICB3aGlsZSAoICsraSA8IG4gKSB7XG5cdGQgPSBzdHJpbmdbaV07XG5cdGlmICggZCA9PT0gJ1xcbicgKSBicmVhayA7XG5cdGJ1ZmZlciArPSBkIDtcbiAgICAgIH1cbiAgICAgIHlpZWxkIFsgJ2NvbW1lbnQnICwgYnVmZmVyICwgbmV3IFBvc2l0aW9uKGxpbmUsIHBvc2l0aW9uKSBdIDtcbiAgICAgIHBvc2l0aW9uICs9IGJ1ZmZlci5sZW5ndGg7XG4gICAgICBidWZmZXIgPSAnJztcbiAgICAgIGlmICggaSA8IG4gKSB7XG5cdHlpZWxkIFsgJ1xcbicgLCAnXFxuJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG5cdCsrbGluZTtcbiAgICAgICAgcG9zaXRpb24gPSBGSVJTVF9QT1NJVElPTjtcbiAgICAgIH1cbiAgICAgICsraTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBidWZmZXIgKz0gYyA7XG4gICAgICArK2k7XG4gICAgfVxuICB9XG5cbiAgeWllbGQqIGZsdXNoKCk7XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uKiB0b2tlbnMgKCBzdHJpbmcgKSB7XG5cbiAgZm9yICggY29uc3QgWyB0ZXJtaW5hbCAsIGJ1ZmZlciAsIHBvc2l0aW9uIF0gb2YgX3Rva2VucyhzdHJpbmcpICkge1xuICAgIHlpZWxkIHtcbiAgICAgICd0eXBlJyA6ICdsZWFmJyAsXG4gICAgICB0ZXJtaW5hbCAsXG4gICAgICBidWZmZXIgLFxuICAgICAgcG9zaXRpb24gLFxuICAgIH1cbiAgfVxufVxuIl19