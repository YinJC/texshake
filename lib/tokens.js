'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.tokens = tokens;
function* tokens(string) {

  let i = 0;
  let n = string.length;

  let buffer = '';

  const flush = function* () {
    if (buffer !== '') {
      yield ['text', buffer];
      buffer = '';
    }
  };

  while (i < n) {
    const c = string[i];
    if (c === '\\') {

      // read command

      let cmd = c;
      while (++i < n) {
        const d = string[i];
        // http://www.tex.ac.uk/FAQ-whatmacros.html
        if (d >= 'a' && d <= 'z' || d >= 'A' && d <= 'Z') cmd += d;else {
          if (cmd === '\\') {
            cmd += d;
            ++i;
          }
          break;
        }
      }

      yield* flush();

      if (cmd.substr(0, 3) === '\\if') yield ['ifcmd', cmd];else if (cmd.substr(cmd.length - 5, 5) === 'false') yield ['falsecmd', cmd];else if (cmd.substr(cmd.length - 4, 4) === 'true') yield ['truecmd', cmd];else if (cmd === '\\newif') yield ['newif', cmd];else if (cmd === '\\else') yield ['else', cmd];else if (cmd === '\\def') yield ['def', cmd];else if (cmd === '\\newcommand') yield ['newcommand', cmd];else if (cmd === '\\fi') yield ['fi', cmd];else yield ['othercmd', cmd];
    } else if (c === '#') {

      // read arg number
      let arg = '#';
      while (++i < n) {
        const d = string[i];
        if (d >= '0' && d <= '9') arg += d;else {
          if (arg === '#') throw new Error('Incomplete #');
          break;
        }
      }
      yield* flush();
      yield ['arg', arg];
    } else if (c === '{') {
      yield* flush();
      yield ['{', '{'];
      ++i;
    } else if (c === '}') {
      yield* flush();
      yield ['}', '}'];
      ++i;
    } else if (c === '[') {
      yield* flush();
      yield ['[', '['];
      ++i;
    } else if (c === ']') {
      yield* flush();
      yield [']', ']'];
      ++i;
    } else if (c === '*') {
      yield* flush();
      yield ['*', '*'];
      ++i;
    } else if (c === '%') {
      yield* flush();
      buffer = '%';
      let d = '';
      while (++i < n) {
        d = string[i];
        if (d === '\n') break;
        buffer += d;
      }
      yield ['comment', buffer];
      if (i < n) buffer = d;else buffer = '';
      ++i;
    } else {
      buffer += c;
      ++i;
    }
  }

  yield* flush();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90b2tlbnMuanMiXSwibmFtZXMiOlsidG9rZW5zIiwic3RyaW5nIiwiaSIsIm4iLCJsZW5ndGgiLCJidWZmZXIiLCJmbHVzaCIsImMiLCJjbWQiLCJkIiwic3Vic3RyIiwiYXJnIiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7O1FBQWlCQSxNLEdBQUFBLE07QUFBVixVQUFVQSxNQUFWLENBQW1CQyxNQUFuQixFQUE0Qjs7QUFFakMsTUFBSUMsSUFBSSxDQUFSO0FBQ0EsTUFBSUMsSUFBSUYsT0FBT0csTUFBZjs7QUFFQSxNQUFJQyxTQUFTLEVBQWI7O0FBRUEsUUFBTUMsUUFBUSxhQUFhO0FBQ3pCLFFBQUtELFdBQVcsRUFBaEIsRUFBcUI7QUFDbkIsWUFBTSxDQUFFLE1BQUYsRUFBV0EsTUFBWCxDQUFOO0FBQ0FBLGVBQVMsRUFBVDtBQUNEO0FBQ0YsR0FMRDs7QUFPQSxTQUFRSCxJQUFJQyxDQUFaLEVBQWdCO0FBQ2QsVUFBTUksSUFBSU4sT0FBT0MsQ0FBUCxDQUFWO0FBQ0EsUUFBS0ssTUFBTSxJQUFYLEVBQWtCOztBQUVoQjs7QUFFQSxVQUFJQyxNQUFNRCxDQUFWO0FBQ0EsYUFBUSxFQUFFTCxDQUFGLEdBQU1DLENBQWQsRUFBa0I7QUFDdkIsY0FBTU0sSUFBSVIsT0FBT0MsQ0FBUCxDQUFWO0FBQ0E7QUFDQSxZQUFPTyxLQUFLLEdBQUwsSUFBWUEsS0FBSyxHQUFuQixJQUE4QkEsS0FBSyxHQUFMLElBQVlBLEtBQUssR0FBcEQsRUFBNERELE9BQU9DLENBQVAsQ0FBNUQsS0FDSztBQUNILGNBQUtELFFBQVEsSUFBYixFQUFvQjtBQUNsQkEsbUJBQU9DLENBQVA7QUFDQSxjQUFFUCxDQUFGO0FBQ0Q7QUFDRDtBQUNEO0FBQ0s7O0FBRUQsYUFBT0ksT0FBUDs7QUFFQSxVQUFLRSxJQUFJRSxNQUFKLENBQVcsQ0FBWCxFQUFhLENBQWIsTUFBb0IsTUFBekIsRUFBa0MsTUFBTSxDQUFFLE9BQUYsRUFBWUYsR0FBWixDQUFOLENBQWxDLEtB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O0FBQ0EsUUFBRUwsQ0FBRjtBQUNEO0FBQ0Y7O0FBRUQsU0FBT0ksT0FBUDtBQUVEIiwiZmlsZSI6InRva2Vucy5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiogdG9rZW5zICggc3RyaW5nICkge1xuXG4gIGxldCBpID0gMCA7XG4gIGxldCBuID0gc3RyaW5nLmxlbmd0aCA7XG5cbiAgbGV0IGJ1ZmZlciA9ICcnO1xuXG4gIGNvbnN0IGZsdXNoID0gZnVuY3Rpb24qICgpIHtcbiAgICBpZiAoIGJ1ZmZlciAhPT0gJycgKSB7XG4gICAgICB5aWVsZCBbICd0ZXh0JyAsIGJ1ZmZlciBdIDtcbiAgICAgIGJ1ZmZlciA9ICcnO1xuICAgIH1cbiAgfVxuXG4gIHdoaWxlICggaSA8IG4gKSB7XG4gICAgY29uc3QgYyA9IHN0cmluZ1tpXSA7XG4gICAgaWYgKCBjID09PSAnXFxcXCcgKSB7XG5cbiAgICAgIC8vIHJlYWQgY29tbWFuZFxuXG4gICAgICBsZXQgY21kID0gYyA7XG4gICAgICB3aGlsZSAoICsraSA8IG4gKSB7XG5cdGNvbnN0IGQgPSBzdHJpbmdbaV07XG5cdC8vIGh0dHA6Ly93d3cudGV4LmFjLnVrL0ZBUS13aGF0bWFjcm9zLmh0bWxcblx0aWYgKCAoIGQgPj0gJ2EnICYmIGQgPD0gJ3onICkgfHwgKCBkID49ICdBJyAmJiBkIDw9ICdaJyApICkgY21kICs9IGQ7XG5cdGVsc2Uge1xuXHQgIGlmICggY21kID09PSAnXFxcXCcgKSB7XG5cdCAgICBjbWQgKz0gZDtcblx0ICAgICsraTtcblx0ICB9XG5cdCAgYnJlYWs7XG5cdH1cbiAgICAgIH1cblxuICAgICAgeWllbGQqIGZsdXNoKCk7XG5cbiAgICAgIGlmICggY21kLnN1YnN0cigwLDMpID09PSAnXFxcXGlmJyApIHlpZWxkIFsgJ2lmY21kJyAsIGNtZCBdIDtcblxuICAgICAgZWxzZSBpZiAoY21kLnN1YnN0cihjbWQubGVuZ3RoLTUsIDUpID09PSAnZmFsc2UnICkgeWllbGQgWyAnZmFsc2VjbWQnICwgY21kIF0gO1xuXG4gICAgICBlbHNlIGlmIChjbWQuc3Vic3RyKGNtZC5sZW5ndGgtNCwgNCkgPT09ICd0cnVlJyApIHlpZWxkIFsgJ3RydWVjbWQnICwgY21kIF0gO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXG5ld2lmJyApICB5aWVsZCBbICduZXdpZicgLCBjbWQgXSA7XG5cbiAgICAgIGVsc2UgaWYgKCBjbWQgPT09ICdcXFxcZWxzZScgKSAgeWllbGQgWyAnZWxzZScgLCBjbWQgXSA7XG5cbiAgICAgIGVsc2UgaWYgKCBjbWQgPT09ICdcXFxcZGVmJyApICB5aWVsZCBbICdkZWYnICwgY21kIF0gO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXG5ld2NvbW1hbmQnICkgIHlpZWxkIFsgJ25ld2NvbW1hbmQnICwgY21kIF0gO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXGZpJyApICB5aWVsZCBbICdmaScgLCBjbWQgXSA7XG5cbiAgICAgIGVsc2UgeWllbGQgWyAnb3RoZXJjbWQnICwgY21kIF0gO1xuXG4gICAgfVxuICAgIGVsc2UgaWYgKCBjID09PSAnIycgKSB7XG5cbiAgICAgIC8vIHJlYWQgYXJnIG51bWJlclxuICAgICAgbGV0IGFyZyA9ICcjJyA7XG4gICAgICB3aGlsZSAoICsraSA8IG4gKSB7XG5cdGNvbnN0IGQgPSBzdHJpbmdbaV07XG5cdGlmICggZCA+PSAnMCcgJiYgZCA8PSAnOScgKSBhcmcgKz0gZDtcblx0ZWxzZSB7XG5cdCAgaWYgKCBhcmcgPT09ICcjJyApIHRocm93IG5ldyBFcnJvcignSW5jb21wbGV0ZSAjJykgO1xuXHQgIGJyZWFrO1xuXHR9XG4gICAgICB9XG4gICAgICB5aWVsZCogZmx1c2goKTtcbiAgICAgIHlpZWxkIFsgJ2FyZycgLCBhcmcgXVxuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ3snICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICd7JyAsICd7JyBdIDtcbiAgICAgICsraTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIGMgPT09ICd9JyApIHtcbiAgICAgIHlpZWxkKiBmbHVzaCgpO1xuICAgICAgeWllbGQgWyAnfScgLCAnfScgXSA7XG4gICAgICArK2k7XG4gICAgfVxuICAgIGVsc2UgaWYgKCBjID09PSAnWycgKSB7XG4gICAgICB5aWVsZCogZmx1c2goKTtcbiAgICAgIHlpZWxkIFsgJ1snICwgJ1snIF0gO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ10nICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICddJyAsICddJyBdIDtcbiAgICAgICsraTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIGMgPT09ICcqJyApIHtcbiAgICAgIHlpZWxkKiBmbHVzaCgpO1xuICAgICAgeWllbGQgWyAnKicgLCAnKicgXSA7XG4gICAgICArK2k7XG4gICAgfVxuICAgIGVsc2UgaWYgKCBjID09PSAnJScpIHtcbiAgICAgIHlpZWxkKiBmbHVzaCgpO1xuICAgICAgYnVmZmVyID0gJyUnO1xuICAgICAgbGV0IGQgPSAnJztcbiAgICAgIHdoaWxlICggKytpIDwgbiApIHtcblx0ZCA9IHN0cmluZ1tpXTtcblx0aWYgKCBkID09PSAnXFxuJyApIGJyZWFrIDtcblx0YnVmZmVyICs9IGQgO1xuICAgICAgfVxuICAgICAgeWllbGQgWyAnY29tbWVudCcgLCBidWZmZXIgXSA7XG4gICAgICBpZiAoIGkgPCBuICkgYnVmZmVyID0gZDtcbiAgICAgIGVsc2UgYnVmZmVyID0gJyc7XG4gICAgICArK2k7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgYnVmZmVyICs9IGMgO1xuICAgICAgKytpO1xuICAgIH1cbiAgfVxuXG4gIHlpZWxkKiBmbHVzaCgpO1xuXG59XG4iXX0=