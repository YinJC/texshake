'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.tokens = tokens;

var _Position = require('./Position');

const FIRST_LINE = 1;
const FIRST_POSITION = 1;

function* _tokens(string) {

  let line = FIRST_LINE;
  let position = FIRST_POSITION;
  let i = 0;
  let n = string.length;

  let buffer = '';

  const flush = function* () {
    if (buffer !== '') {
      yield ['text', buffer, new _Position.Position(line, position)];
      position += buffer.length;
      buffer = '';
    }
  };

  while (i < n) {
    const c = string[i];
    if (c === '\\') {
      let cmd = '\\';
      while (++i < n) {
        // read command
        const d = string[i];
        // http://www.tex.ac.uk/FAQ-whatmacros.html
        if (d >= 'a' && d <= 'z' || d >= 'A' && d <= 'Z') cmd += d;else {
          if (cmd === '\\') {
            cmd += d;
            ++i;
          }
          break;
        }
      }

      yield* flush();

      let cmdtype = 'othercmd';

      if (cmd.substr(0, 3) === '\\if') cmdtype = 'ifcmd';else if (cmd.substr(cmd.length - 5, 5) === 'false') cmdtype = 'falsecmd';else if (cmd.substr(cmd.length - 4, 4) === 'true') cmdtype = 'truecmd';else if (cmd === '\\newif') cmdtype = 'newif';else if (cmd === '\\else') cmdtype = 'else';else if (cmd === '\\def') cmdtype = 'def';else if (cmd === '\\newcommand') cmdtype = 'newcommand';else if (cmd === '\\fi') cmdtype = 'fi';else if (cmd === '\\(') cmdtype = '\\(';else if (cmd === '\\)') cmdtype = '\\)';else if (cmd === '\\[') cmdtype = '\\[';else if (cmd === '\\]') cmdtype = '\\]';

      yield [cmdtype, cmd, new _Position.Position(line, position)];
      if (cmd === '\\\n') {
        ++line;
        position = FIRST_POSITION;
      } else {
        position += cmd.length;
      }
    } else if (c === '#') {
      yield* flush();

      // read arg number
      let arg = '#';
      while (++i < n) {
        const d = string[i];
        if (d >= '0' && d <= '9') arg += d;else break;
      }
      if (arg === '#') throw new Error('Incomplete #');
      yield ['arg', arg, new _Position.Position(line, position)];
      position += arg.length;
    } else if (c === '{') {
      yield* flush();
      yield ['{', '{', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '}') {
      yield* flush();
      yield ['}', '}', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '[') {
      yield* flush();
      yield ['[', '[', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === ']') {
      yield* flush();
      yield [']', ']', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '*') {
      yield* flush();
      yield ['*', '*', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '$') {
      yield* flush();
      yield ['$', '$', new _Position.Position(line, position)];
      ++position;
      ++i;
    } else if (c === '\n') {
      yield* flush();
      yield ['\n', '\n', new _Position.Position(line, position)];
      ++line;
      position = FIRST_POSITION;
      ++i;
    } else if (c === '%') {
      yield* flush();
      buffer = '%';
      let d = '';
      while (++i < n) {
        d = string[i];
        if (d === '\n') break;
        buffer += d;
      }
      yield ['comment', buffer, new _Position.Position(line, position)];
      position += buffer.length;
      buffer = '';
      if (i < n) {
        yield ['\n', '\n', new _Position.Position(line, position)];
        ++line;
        position = FIRST_POSITION;
      }
      ++i;
    } else {
      buffer += c;
      ++i;
    }
  }

  yield* flush();
}

function* tokens(string) {

  for (const [terminal, buffer, position] of _tokens(string)) {
    yield {
      'type': 'leaf',
      terminal,
      buffer,
      position
    };
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy90b2tlbnMuanMiXSwibmFtZXMiOlsidG9rZW5zIiwiRklSU1RfTElORSIsIkZJUlNUX1BPU0lUSU9OIiwiX3Rva2VucyIsInN0cmluZyIsImxpbmUiLCJwb3NpdGlvbiIsImkiLCJuIiwibGVuZ3RoIiwiYnVmZmVyIiwiZmx1c2giLCJQb3NpdGlvbiIsImMiLCJjbWQiLCJkIiwiY21kdHlwZSIsInN1YnN0ciIsImFyZyIsIkVycm9yIiwidGVybWluYWwiXSwibWFwcGluZ3MiOiI7Ozs7O1FBbUtpQkEsTSxHQUFBQSxNOztBQW5LakI7O0FBRUEsTUFBTUMsYUFBYSxDQUFuQjtBQUNBLE1BQU1DLGlCQUFpQixDQUF2Qjs7QUFFQSxVQUFVQyxPQUFWLENBQW9CQyxNQUFwQixFQUE2Qjs7QUFFM0IsTUFBSUMsT0FBT0osVUFBWDtBQUNBLE1BQUlLLFdBQVdKLGNBQWY7QUFDQSxNQUFJSyxJQUFJLENBQVI7QUFDQSxNQUFJQyxJQUFJSixPQUFPSyxNQUFmOztBQUVBLE1BQUlDLFNBQVMsRUFBYjs7QUFFQSxRQUFNQyxRQUFRLGFBQWE7QUFDekIsUUFBS0QsV0FBVyxFQUFoQixFQUFxQjtBQUNuQixZQUFNLENBQUUsTUFBRixFQUFXQSxNQUFYLEVBQW9CLElBQUlFLGtCQUFKLENBQWFQLElBQWIsRUFBbUJDLFFBQW5CLENBQXBCLENBQU47QUFDQUEsa0JBQVlJLE9BQU9ELE1BQW5CO0FBQ0FDLGVBQVMsRUFBVDtBQUNEO0FBQ0YsR0FORDs7QUFRQSxTQUFRSCxJQUFJQyxDQUFaLEVBQWdCO0FBQ2QsVUFBTUssSUFBSVQsT0FBT0csQ0FBUCxDQUFWO0FBQ0EsUUFBS00sTUFBTSxJQUFYLEVBQWtCO0FBQ2hCLFVBQUlDLE1BQU0sSUFBVjtBQUNBLGFBQVEsRUFBRVAsQ0FBRixHQUFNQyxDQUFkLEVBQWtCO0FBQUU7QUFDekIsY0FBTU8sSUFBSVgsT0FBT0csQ0FBUCxDQUFWO0FBQ0E7QUFDQSxZQUFPUSxLQUFLLEdBQUwsSUFBWUEsS0FBSyxHQUFuQixJ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QUlLLElBQUksRUFBUjtBQUNBLGFBQVEsRUFBRVIsQ0FBRixHQUFNQyxDQUFkLEVBQWtCO0FBQ3ZCTyxZQUFJWCxPQUFPRyxDQUFQLENBQUo7QUFDQSxZQUFLUSxNQUFNLElBQVgsRUFBa0I7QUFDbEJMLGtCQUFVSyxDQUFWO0FBQ007QUFDRCxZQUFNLENBQUUsU0FBRixFQUFjTCxNQUFkLEVBQXVCLElBQUlFLGtCQUFKLENBQWFQLElBQWIsRUFBbUJDLFFBQW5CLENBQXZCLENBQU47QUFDQUEsa0JBQVlJLE9BQU9ELE1BQW5CO0FBQ0FDLGVBQVMsRUFBVDtBQUNBLFVBQUtILElBQUlDLENBQVQsRUFBYTtBQUNsQixjQUFNLENBQUUsSUFBRixFQUFTLElBQVQsRUFBZ0IsSUFBSUksa0JBQUosQ0FBYVAsSUFBYixFQUFtQkMsUUFBbkIsQ0FBaEIsQ0FBTjtBQUNBLFVBQUVELElBQUY7QUFDT0MsbUJBQVdKLGNBQVg7QUFDRDtBQUNELFFBQUVLLENBQUY7QUFDRCxLQWxCSSxNQW1CQTtBQUNIRyxnQkFBVUcsQ0FBVjtBQUNBLFFBQUVOLENBQUY7QUFDRDtBQUNGOztBQUVELFNBQU9JLE9BQVA7QUFFRDs7QUFFTSxVQUFVWCxNQUFWLENBQW1CSSxNQUFuQixFQUE0Qjs7QUFFakMsT0FBTSxNQUFNLENBQUVnQixRQUFGLEVBQWFWLE1BQWIsRUFBc0JKLFFBQXRCLENBQVosSUFBZ0RILFFBQVFDLE1BQVIsQ0FBaEQsRUFBa0U7QUFDaEUsVUFBTTtBQUNKLGNBQVMsTUFETDtBQUVKZ0IsY0FGSTtBQUdKVixZQUhJO0FBSUpKO0FBSkksS0FBTjtBQU1EO0FBQ0YiLCJmaWxlIjoidG9rZW5zLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUG9zaXRpb24gfSBmcm9tICcuL1Bvc2l0aW9uJyA7XG5cbmNvbnN0IEZJUlNUX0xJTkUgPSAxO1xuY29uc3QgRklSU1RfUE9TSVRJT04gPSAxO1xuXG5mdW5jdGlvbiogX3Rva2VucyAoIHN0cmluZyApIHtcblxuICBsZXQgbGluZSA9IEZJUlNUX0xJTkUgO1xuICBsZXQgcG9zaXRpb24gPSBGSVJTVF9QT1NJVElPTjtcbiAgbGV0IGkgPSAwIDtcbiAgbGV0IG4gPSBzdHJpbmcubGVuZ3RoIDtcblxuICBsZXQgYnVmZmVyID0gJyc7XG5cbiAgY29uc3QgZmx1c2ggPSBmdW5jdGlvbiogKCkge1xuICAgIGlmICggYnVmZmVyICE9PSAnJyApIHtcbiAgICAgIHlpZWxkIFsgJ3RleHQnICwgYnVmZmVyICwgbmV3IFBvc2l0aW9uKGxpbmUsIHBvc2l0aW9uKSBdIDtcbiAgICAgIHBvc2l0aW9uICs9IGJ1ZmZlci5sZW5ndGg7XG4gICAgICBidWZmZXIgPSAnJztcbiAgICB9XG4gIH1cblxuICB3aGlsZSAoIGkgPCBuICkge1xuICAgIGNvbnN0IGMgPSBzdHJpbmdbaV0gO1xuICAgIGlmICggYyA9PT0gJ1xcXFwnICkge1xuICAgICAgbGV0IGNtZCA9ICdcXFxcJyA7XG4gICAgICB3aGlsZSAoICsraSA8IG4gKSB7IC8vIHJlYWQgY29tbWFuZFxuXHRjb25zdCBkID0gc3RyaW5nW2ldO1xuXHQvLyBodHRwOi8vd3d3LnRleC5hYy51ay9GQVEtd2hhdG1hY3Jvcy5odG1sXG5cdGlmICggKCBkID49ICdhJyAmJiBkIDw9ICd6JyApIHx8ICggZCA+PSAnQScgJiYgZCA8PSAnWicgKSApIGNtZCArPSBkO1xuXHRlbHNlIHtcblx0ICBpZiAoIGNtZCA9PT0gJ1xcXFwnICkge1xuXHQgICAgY21kICs9IGQ7XG5cdCAgICArK2k7XG5cdCAgfVxuXHQgIGJyZWFrO1xuXHR9XG4gICAgICB9XG5cbiAgICAgIHlpZWxkKiBmbHVzaCgpO1xuXG4gICAgICBsZXQgY21kdHlwZSA9ICdvdGhlcmNtZCcgO1xuXG4gICAgICBpZiAoIGNtZC5zdWJzdHIoMCwzKSA9PT0gJ1xcXFxpZicgKSBjbWR0eXBlID0gJ2lmY21kJyA7XG5cbiAgICAgIGVsc2UgaWYgKGNtZC5zdWJzdHIoY21kLmxlbmd0aC01LCA1KSA9PT0gJ2ZhbHNlJyApIGNtZHR5cGUgPSAnZmFsc2VjbWQnIDtcblxuICAgICAgZWxzZSBpZiAoY21kLnN1YnN0cihjbWQubGVuZ3RoLTQsIDQpID09PSAndHJ1ZScgKSBjbWR0eXBlID0gJ3RydWVjbWQnIDtcblxuICAgICAgZWxzZSBpZiAoIGNtZCA9PT0gJ1xcXFxuZXdpZicgKSBjbWR0eXBlID0gJ25ld2lmJyA7XG5cbiAgICAgIGVsc2UgaWYgKCBjbWQgPT09ICdcXFxcZWxzZScgKSBjbWR0eXBlID0gJ2Vsc2UnIDtcblxuICAgICAgZWxzZSBpZiAoIGNtZCA9PT0gJ1xcXFxkZWYnICkgY21kdHlwZSA9ICdkZWYnIDtcblxuICAgICAgZWxzZSBpZiAoIGNtZCA9PT0gJ1xcXFxuZXdjb21tYW5kJyApIGNtZHR5cGUgPSAnbmV3Y29tbWFuZCcgO1xuXG4gICAgICBlbHNlIGlmICggY21kID09PSAnXFxcXGZpJyApIGNtZHR5cGUgPSAnZmknIDtcblxuICAgICAgZWxzZSBpZiAoIGNtZCA9PT0gJ1xcXFwoJyApIGNtZHR5cGUgPSAnXFxcXCgnIDtcblxuICAgICAgZWxzZSBpZiAoIGNtZCA9PT0gJ1xcXFwpJyApIGNtZHR5cGUgPSAnXFxcXCknIDtcblxuICAgICAgZWxzZSBpZiAoIGNtZCA9PT0gJ1xcXFxbJyApIGNtZHR5cGUgPSAnXFxcXFsnIDtcblxuICAgICAgZWxzZSBpZiAoIGNtZCA9PT0gJ1xcXFxdJyApIGNtZHR5cGUgPSAnXFxcXF0nIDtcblxuICAgICAgeWllbGQgWyBjbWR0eXBlICwgY21kICwgbmV3IFBvc2l0aW9uKGxpbmUsIHBvc2l0aW9uKSBdIDtcbiAgICAgIGlmICggY21kID09PSAnXFxcXFxcbicgKSB7XG5cdCsrbGluZTtcblx0cG9zaXRpb24gPSBGSVJTVF9QT1NJVElPTjtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuXHRwb3NpdGlvbiArPSBjbWQubGVuZ3RoO1xuICAgICAgfVxuXG4gICAgfVxuICAgIGVsc2UgaWYgKCBjID09PSAnIycgKSB7XG4gICAgICB5aWVsZCogZmx1c2goKTtcblxuICAgICAgLy8gcmVhZCBhcmcgbnVtYmVyXG4gICAgICBsZXQgYXJnID0gJyMnIDtcbiAgICAgIHdoaWxlICggKytpIDwgbiApIHtcblx0Y29uc3QgZCA9IHN0cmluZ1tpXTtcblx0aWYgKCBkID49ICcwJyAmJiBkIDw9ICc5JyApIGFyZyArPSBkO1xuXHRlbHNlIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKCBhcmcgPT09ICcjJyApIHRocm93IG5ldyBFcnJvcignSW5jb21wbGV0ZSAjJykgO1xuICAgICAgeWllbGQgWyAnYXJnJyAsIGFyZyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICBwb3NpdGlvbiArPSBhcmcubGVuZ3RoO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ3snICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICd7JyAsICd7JyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ30nICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICd9JyAsICd9JyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ1snICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICdbJyAsICdbJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ10nICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICddJyAsICddJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJyonICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICcqJyAsICcqJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJyQnICkge1xuICAgICAgeWllbGQqIGZsdXNoKCk7XG4gICAgICB5aWVsZCBbICckJyAsICckJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK3Bvc2l0aW9uO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJ1xcbicgKSB7XG4gICAgICB5aWVsZCogZmx1c2goKTtcbiAgICAgIHlpZWxkIFsgJ1xcbicgLCAnXFxuJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG4gICAgICArK2xpbmU7XG4gICAgICBwb3NpdGlvbiA9IEZJUlNUX1BPU0lUSU9OO1xuICAgICAgKytpO1xuICAgIH1cbiAgICBlbHNlIGlmICggYyA9PT0gJyUnKSB7XG4gICAgICB5aWVsZCogZmx1c2goKTtcbiAgICAgIGJ1ZmZlciA9ICclJztcbiAgICAgIGxldCBkID0gJyc7XG4gICAgICB3aGlsZSAoICsraSA8IG4gKSB7XG5cdGQgPSBzdHJpbmdbaV07XG5cdGlmICggZCA9PT0gJ1xcbicgKSBicmVhayA7XG5cdGJ1ZmZlciArPSBkIDtcbiAgICAgIH1cbiAgICAgIHlpZWxkIFsgJ2NvbW1lbnQnICwgYnVmZmVyICwgbmV3IFBvc2l0aW9uKGxpbmUsIHBvc2l0aW9uKSBdIDtcbiAgICAgIHBvc2l0aW9uICs9IGJ1ZmZlci5sZW5ndGg7XG4gICAgICBidWZmZXIgPSAnJztcbiAgICAgIGlmICggaSA8IG4gKSB7XG5cdHlpZWxkIFsgJ1xcbicgLCAnXFxuJyAsIG5ldyBQb3NpdGlvbihsaW5lLCBwb3NpdGlvbikgXSA7XG5cdCsrbGluZTtcbiAgICAgICAgcG9zaXRpb24gPSBGSVJTVF9QT1NJVElPTjtcbiAgICAgIH1cbiAgICAgICsraTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBidWZmZXIgKz0gYyA7XG4gICAgICArK2k7XG4gICAgfVxuICB9XG5cbiAgeWllbGQqIGZsdXNoKCk7XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uKiB0b2tlbnMgKCBzdHJpbmcgKSB7XG5cbiAgZm9yICggY29uc3QgWyB0ZXJtaW5hbCAsIGJ1ZmZlciAsIHBvc2l0aW9uIF0gb2YgX3Rva2VucyhzdHJpbmcpICkge1xuICAgIHlpZWxkIHtcbiAgICAgICd0eXBlJyA6ICdsZWFmJyAsXG4gICAgICB0ZXJtaW5hbCAsXG4gICAgICBidWZmZXIgLFxuICAgICAgcG9zaXRpb24gLFxuICAgIH1cbiAgfVxufVxuIl19